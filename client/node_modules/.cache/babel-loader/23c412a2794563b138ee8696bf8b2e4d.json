{"ast":null,"code":"import _slicedToArray from\"/Users/apostolosdedeloudis/Documents/GitHub/Spotify-Clone/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{useState,useEffect}from'react';import{Container,Form}from'react-bootstrap';import useAuth from'./useAuth';import SpotifyWebApi from'spotify-web-api-node';import TrackSearchResult from'./TrackSearchResult';import Player from'./Player';import axios from'axios';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var SpotifyApi=new SpotifyWebApi({clientId:'250a9153ab334c6cba6723476cf799eb'});export default function Dashboard(_ref){var code=_ref.code;var accessToken=useAuth(code);var _useState=useState(''),_useState2=_slicedToArray(_useState,2),search=_useState2[0],setSearch=_useState2[1];var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),searchResults=_useState4[0],setSearchResults=_useState4[1];var _useState5=useState(),_useState6=_slicedToArray(_useState5,2),playingTrack=_useState6[0],setPlayingTrack=_useState6[1];var _useState7=useState(''),_useState8=_slicedToArray(_useState7,2),lyrics=_useState8[0],setLyrics=_useState8[1];function chooseTrack(track){setPlayingTrack(track);setSearchResults([]);setLyrics('');}useEffect(function(){if(!playingTrack)return;axios.get('http://localhost:3001/lyrics',{params:{track:playingTrack.title,artist:playingTrack.artist}}).then(function(res){setLyrics(res.data.lyrics);});},[playingTrack]);useEffect(function(){if(!accessToken)return;SpotifyApi.setAccessToken(accessToken);},[accessToken]);useEffect(function(){if(!search)return setSearchResults([]);if(!accessToken)return;var cancel=false;SpotifyApi.searchTracks(search).then(function(res){if(cancel)return;setSearchResults(res.body.tracks.items.map(function(track){var smallestAlbumImage=track.album.images.reduce(function(smallest,image){if(image.height<smallest.height)return image;return smallest;},track.album.images[0]);return{artist:track.artists[0].name,title:track.name,uri:track.uri,albumURL:smallestAlbumImage.url};}));});return function(){return cancel=true;};},[search,accessToken]);return/*#__PURE__*/_jsxs(Container,{className:\"d-flex flex-column py-2\",style:{height:'100vh'},children:[/*#__PURE__*/_jsx(Form.Control,{type:\"search\",placeholder:\"Search Songs/Artists\",value:search,onChange:function onChange(e){setSearch(e.target.value);}}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex-grow-1 my-2\",style:{overflowY:'auto'},children:[searchResults.map(function(track){return/*#__PURE__*/_jsx(TrackSearchResult,{track:track,chooseTrack:chooseTrack},track.uri);}),searchResults.length===0&&/*#__PURE__*/_jsx(\"div\",{className:\"text-center\",style:{whiteSpace:'pre'},children:lyrics})]}),/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(Player,{accessToken:accessToken,trackUri:playingTrack===null||playingTrack===void 0?void 0:playingTrack.uri})})]});}","map":{"version":3,"sources":["/Users/apostolosdedeloudis/Documents/GitHub/Spotify-Clone/client/src/Dashboard.jsx"],"names":["useState","useEffect","Container","Form","useAuth","SpotifyWebApi","TrackSearchResult","Player","axios","SpotifyApi","clientId","Dashboard","code","accessToken","search","setSearch","searchResults","setSearchResults","playingTrack","setPlayingTrack","lyrics","setLyrics","chooseTrack","track","get","params","title","artist","then","res","data","setAccessToken","cancel","searchTracks","body","tracks","items","map","smallestAlbumImage","album","images","reduce","smallest","image","height","artists","name","uri","albumURL","url","e","target","value","overflowY","length","whiteSpace"],"mappings":"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","sourcesContent":["import {useState, useEffect} from 'react'\nimport {Container, Form} from 'react-bootstrap';\nimport useAuth from './useAuth';\nimport SpotifyWebApi from 'spotify-web-api-node'\nimport TrackSearchResult from './TrackSearchResult'\nimport Player from './Player';\nimport axios from 'axios';\n\nconst SpotifyApi = new SpotifyWebApi({\n    clientId: '250a9153ab334c6cba6723476cf799eb'\n})\n\nexport default function Dashboard({ code }) {\n    const accessToken = useAuth(code)\n    const [search, setSearch] = useState('')\n    const [searchResults, setSearchResults] = useState([])\n    const [playingTrack, setPlayingTrack] = useState()\n    const [lyrics, setLyrics] = useState('')\n    \n    function chooseTrack(track) {\n        setPlayingTrack(track)\n        setSearchResults([])\n        setLyrics('')\n    }\n    \n    useEffect(() => {\n        if (!playingTrack) return\n        axios.get('http://localhost:3001/lyrics', {\n            params: {\n                track: playingTrack.title,\n                artist: playingTrack.artist\n            }\n        }).then(res => {\n            setLyrics(res.data.lyrics)\n        })\n    }, [playingTrack])\n    \n    useEffect(() => {\n        if (!accessToken) return\n        SpotifyApi.setAccessToken(accessToken)\n    }, [accessToken])\n    \n    useEffect(() => {\n        if (!search) return setSearchResults([])\n        if (!accessToken) return \n        \n        let cancel = false\n        \n        SpotifyApi.searchTracks(search).then(res => {\n            if (cancel) return \n            setSearchResults(res.body.tracks.items.map(track => {\n                const smallestAlbumImage = track.album.images.reduce((smallest, image) => {\n                    if (image.height < smallest.height) return image\n                    return smallest\n                }, track.album.images[0])\n                return{\n                    artist: track.artists[0].name,\n                    title: track.name,\n                    uri: track.uri,\n                    albumURL: smallestAlbumImage.url\n                    \n                }\n            })\n        )})\n        return () => cancel = true\n    }, [search, accessToken])\n    \n    return (\n            <Container className='d-flex flex-column py-2' style={{height: '100vh'}}>\n                <Form.Control type='search' placeholder='Search Songs/Artists' value={search} onChange={e => {setSearch(e.target.value)}} />\n                <div className='flex-grow-1 my-2' style={{overflowY: 'auto'}}>\n                     {searchResults.map(track => (\n                        <TrackSearchResult\n                            track={track}\n                            key={track.uri}\n                            chooseTrack={chooseTrack}\n                        />\n                     ))}\n                     {searchResults.length === 0 && (\n                        <div className='text-center' style={{whiteSpace: 'pre'}}>{lyrics}</div>\n                     )}\n                </div>\n                <div><Player accessToken={accessToken} trackUri={playingTrack?.uri} /></div>\n            </Container>\n    )\n}"]},"metadata":{},"sourceType":"module"}